<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>ì‚¬ì§„ ì¤„ì´ê¸° (ì¹´í†¡/ì‚¬íŒŒë¦¬ ëŒ€ì‘)</title>
  <style>
    :root{
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      --bg1:#ffb65a; --bg2:#ffe0b2;
      --card:#fff7ed; --ink:#4a2c1a; --muted: rgba(74,44,26,.78);
      --accent:#ff6a00; --accent2:#ff8a2a; --stroke: rgba(74,44,26,.16);
      --ok:#1b7a3a;
    }
    body{ margin:0; min-height:100vh; background:linear-gradient(135deg,var(--bg1),var(--bg2)); color:var(--ink); }
    .wrap{ max-width:980px; margin:0 auto; padding:16px 14px 36px; padding-bottom:calc(36px + env(safe-area-inset-bottom)); }
    h1{ margin:8px 0 6px; font-size:20px; }
    .sub{ margin:0 0 14px; color:var(--muted); line-height:1.45; font-size:13px; }

    .banner{
      display:none;
      background: rgba(255,255,255,.65);
      border: 1px solid rgba(255,255,255,.55);
      border-left: 6px solid var(--accent);
      border-radius: 14px;
      padding: 10px 12px;
      margin: 10px 0 14px;
      box-shadow: 0 10px 25px rgba(0,0,0,.08);
      font-size: 12px;
      line-height: 1.4;
      color: rgba(74,44,26,.95);
    }
    .banner b{ color: var(--accent); }
    .banner .row{
      display:flex; gap:8px; margin-top:8px; flex-wrap:wrap;
      align-items:center;
    }
    .chip{
      display:inline-flex; align-items:center; justify-content:center;
      padding: 7px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,106,0,.18);
      background:#fff1dc;
      color: rgba(74,44,26,.92);
      cursor: pointer;
      user-select:none;
      -webkit-user-select:none;
    }

    .card{ background:var(--card); border-radius:18px; box-shadow:0 18px 40px rgba(0,0,0,.16); border:1px solid rgba(255,255,255,.35); overflow:hidden; }
    .section{ padding:14px; }
    .divider{ height:1px; background:rgba(74,44,26,.08); }

    .dropzone{
      border:2px dashed rgba(255,106,0,.55);
      border-radius:16px; padding:16px;
      background:#fffaf4; text-align:center;
      user-select:none; -webkit-user-select:none; touch-action:manipulation;
    }
    .dz-title{ font-weight:900; color:var(--accent); font-size:15px; }
    .dz-hint{ margin-top:6px; color:var(--muted); font-size:12px; }

    /* iOS/ì¸ì•±: input display:none ê¸ˆì§€(ê¶Œì¥) */
    .file-input{
      position:absolute; left:-9999px; width:1px; height:1px; opacity:0;
    }
    .pick{
      margin-top:12px;
      display:inline-flex; align-items:center; justify-content:center; gap:8px;
      width:100%; max-width:520px;
      padding:12px 14px; border-radius:14px;
      background:linear-gradient(135deg,var(--accent),var(--accent2));
      color:white; font-weight:900;
      cursor:pointer; -webkit-tap-highlight-color:transparent;
    }
    .mini{ margin-top:10px; font-size:12px; color:var(--muted); }

    .grid{ display:grid; grid-template-columns:1fr 1fr; gap:10px; }
    @media (max-width:420px){ .grid{ grid-template-columns:1fr; } }

    label.meta{ display:block; font-size:12px; margin:10px 0 6px; color:var(--muted); }
    input[type="number"], input[type="text"], select{
      width:100%; padding:12px 12px; border-radius:14px;
      border:1px solid var(--stroke); background:#fff; font-size:15px; outline:none;
    }
    input[type="range"]{ width:100%; accent-color:var(--accent); }
    .inline{ display:flex; align-items:center; justify-content:space-between; gap:10px; }

    .btnrow{ display:flex; gap:10px; flex-wrap:wrap; margin-top:12px; }
    .btn{
      flex:1; min-width:140px; padding:12px 14px; border-radius:14px; border:0;
      font-weight:900; cursor:pointer;
    }
    .btn.primary{ background:var(--accent); color:#fff; }
    .btn.secondary{ background:#ffe3c4; color:#6a3b1a; }
    .btn.ok{ background: var(--ok); color:#fff; }
    .btn:disabled{ opacity:.5; cursor:not-allowed; }

    .pillrow{ display:flex; gap:8px; flex-wrap:wrap; margin-top:10px; }
    .pill{ background:#fff1dc; border:1px solid rgba(255,106,0,.15); padding:6px 10px; border-radius:999px; font-size:12px; }
    .error{ background:#ffe3e3; border:1px solid rgba(180,0,0,.2); color:#7a1b1b; }

    .preview{ display:grid; grid-template-columns:1fr 1fr; gap:10px; }
    @media (max-width:780px){ .preview{ grid-template-columns:1fr; } }
    .box{ border-radius:16px; background:#fff; border:1px solid rgba(74,44,26,.10); overflow:hidden; }
    .box header{ padding:9px 12px; background:#fff1dc; font-weight:900; font-size:13px; }
    .box .inner{ padding:10px; }
    img, canvas{ width:100%; height:auto; border-radius:12px; display:block; background:#f7f0e8; }

    .saveGuide{
      margin-top:10px;
      padding:10px 12px;
      background:#fff1dc;
      border:1px solid rgba(255,106,0,.15);
      border-radius:14px;
      font-size:12px;
      color:rgba(74,44,26,.9);
      line-height:1.4;
    }
    .saveGuide b{ color: var(--accent); }

    .note{ font-size:12px; color:var(--muted); line-height:1.45; margin:10px 0 0; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>ğŸ“± ì‚¬ì§„ ì¤„ì´ê¸° (ì¹´í†¡/ì‚¬íŒŒë¦¬ ëŒ€ì‘)</h1>
    <p class="sub">ì‚¬ì§„ ì„ íƒ â†’ ì¤„ì´ê¸° â†’ (ì¹´í†¡/ì•„ì´í°) ê²°ê³¼ ì´ë¯¸ì§€ë¥¼ ê¸¸ê²Œ ëˆŒëŸ¬ ì €ì¥ ë˜ëŠ” ê³µìœ </p>

    <div id="banner" class="banner">
      <div>ì§€ê¸ˆ <b>ì¹´ì¹´ì˜¤í†¡ ì¸ì•± ë¸Œë¼ìš°ì €</b>ë¡œ ì—´ë¦° ê²ƒ ê°™ì•„ìš”. ì—¬ê¸°ì„œëŠ” â€œíŒŒì¼ ë‹¤ìš´ë¡œë“œâ€ê°€ ì œí•œë  ìˆ˜ ìˆì–´ìš”.</div>
      <div>âœ… í•´ê²°: <b>ì¤„ì´ê¸° í›„ ê²°ê³¼ ì´ë¯¸ì§€ë¥¼ ê¸¸ê²Œ ëˆŒëŸ¬ ì €ì¥</b>í•˜ë©´ ë©ë‹ˆë‹¤. ë” ì•ˆì •ì ìœ¼ë¡œ ì“°ë ¤ë©´ ìƒë‹¨ ë©”ë‰´ì—ì„œ <b>Safarië¡œ ì—´ê¸°</b>ë¥¼ ì¶”ì²œí•´ìš”.</div>
      <div class="row">
        <span id="copyLink" class="chip">ğŸ”— ë§í¬ ë³µì‚¬</span>
        <span id="hintBtn" class="chip">ğŸ“Œ ì €ì¥ ë°©ë²• ë³´ê¸°</span>
      </div>
    </div>

    <div class="card">
      <div class="section">
        <div class="dropzone">
          <div class="dz-title">ì‚¬ì§„ì„ ì„ íƒí•˜ì„¸ìš”</div>
          <div class="dz-hint">ì•„ì´í°/ì¹´í†¡ì€ ë²„íŠ¼ìœ¼ë¡œ ì„ íƒí•˜ëŠ” ê²Œ ê°€ì¥ ì•ˆì •ì ì´ì—ìš”</div>

          <label for="file" class="pick">ğŸ“· ì´ë¯¸ì§€ ì„ íƒí•˜ê¸°</label>
          <input id="file" class="file-input" type="file" accept="image/*" />

          <div class="mini">JPG/PNG/WEBP ê°€ëŠ¥ (ì—…ë¡œë“œ ì—†ìŒ)</div>
        </div>

        <div class="pillrow" id="stats"></div>

        <div class="grid">
          <div>
            <label class="meta">ìµœëŒ€ ê°€ë¡œ(px)</label>
            <input id="maxW" type="number" min="1" value="1600" />
          </div>
          <div>
            <label class="meta">ìµœëŒ€ ì„¸ë¡œ(px)</label>
            <input id="maxH" type="number" min="1" value="1600" />
          </div>
        </div>

        <label class="meta inline">
          <span>í’ˆì§ˆ(quality)</span>
          <b><span id="qVal">0.82</span></b>
        </label>
        <input id="quality" type="range" min="0.1" max="1" step="0.01" value="0.82" />

        <div class="grid">
          <div>
            <label class="meta">ì¶œë ¥ í¬ë§·</label>
            <select id="format">
              <option value="image/jpeg" selected>JPG</option>
              <option value="image/webp">WEBP</option>
              <option value="image/png">PNG</option>
            </select>
          </div>
          <div>
            <label class="meta">íŒŒì¼ëª… (í™•ì¥ì ìë™)</label>
            <input id="outName" type="text" placeholder="ì˜ˆ) photo_resized" />
          </div>
        </div>

        <div class="btnrow">
          <button id="run" class="btn primary" type="button" disabled>ì¤„ì´ê¸°</button>
          <button id="share" class="btn ok" type="button" disabled>ê³µìœ /ì €ì¥</button>
          <button id="openImg" class="btn secondary" type="button" disabled>ê²°ê³¼ ì´ë¯¸ì§€ í¬ê²Œ ì—´ê¸°</button>
          <button id="reset" class="btn secondary" type="button">ì´ˆê¸°í™”</button>
        </div>

        <p class="note">
          âœ… ì¹´í†¡ ì¸ì•±ì—ì„œëŠ” â€œë‹¤ìš´ë¡œë“œâ€ê°€ ë§‰í ìˆ˜ ìˆì–´ìš”. <b>ê³µìœ /ì €ì¥</b> ë˜ëŠ” <b>ê²°ê³¼ ì´ë¯¸ì§€ ê¸¸ê²Œ ëˆŒëŸ¬ ì €ì¥</b>ì´ ê°€ì¥ í™•ì‹¤í•´ìš”.
        </p>
      </div>

      <div class="divider"></div>

      <div class="section">
        <div class="preview">
          <div class="box">
            <header>ì›ë³¸</header>
            <div class="inner"><img id="origImg" alt="ì›ë³¸ ë¯¸ë¦¬ë³´ê¸°" /></div>
          </div>

          <div class="box">
            <header>ê²°ê³¼</header>
            <div class="inner">
              <canvas id="canvas"></canvas>

              <!-- âœ… ì¹´í†¡/ì•„ì´í° ì €ì¥ ìµœê°•: ê²°ê³¼ë¥¼ imgë¡œ ë°”ë¡œ í‘œì‹œ -->
              <img id="resultImg" alt="ê²°ê³¼ ì´ë¯¸ì§€(ê¸¸ê²Œ ëˆŒëŸ¬ ì €ì¥)" style="display:none; margin-top:10px;" />

              <div id="saveGuide" class="saveGuide" style="display:none;">
                âœ… ì €ì¥ ë°©ë²•<br/>
                1) ì•„ë˜ <b>ê²°ê³¼ ì´ë¯¸ì§€</b>ë¥¼ <b>ê¸¸ê²Œ ëˆ„ë¥´ê¸°</b><br/>
                2) <b>â€˜ì‚¬ì§„ì— ì €ì¥/ì‚¬ì§„ì— ì¶”ê°€â€™</b> ì„ íƒ<br/>
                (ë˜ëŠ” ìœ„ì˜ <b>ê³µìœ /ì €ì¥</b> ë²„íŠ¼ ì‚¬ìš©)
              </div>
            </div>
          </div>
        </div>
      </div>
    </div><!-- /card -->
  </div><!-- /wrap -->

<script>
  const $ = (id) => document.getElementById(id);

  // Elements
  const banner = $("banner");
  const copyLinkBtn = $("copyLink");
  const hintBtn = $("hintBtn");

  const fileInput = $("file");
  const origImg = $("origImg");
  const canvas = $("canvas");
  const ctx = canvas.getContext("2d");

  const maxW = $("maxW");
  const maxH = $("maxH");
  const quality = $("quality");
  const qVal = $("qVal");
  const format = $("format");
  const outName = $("outName");

  const runBtn = $("run");
  const shareBtn = $("share");
  const openImgBtn = $("openImg");
  const resetBtn = $("reset");
  const stats = $("stats");

  const resultImg = $("resultImg");
  const saveGuide = $("saveGuide");

  // State
  let originalFile = null;
  let loadedImage = null; // HTMLImageElement
  let outBlob = null;
  let outUrl = null;

  // Detect Kakao in-app
  function isKakaoInApp() {
    const ua = navigator.userAgent || "";
    return /KAKAOTALK/i.test(ua);
  }

  // Basic helpers
  const extForMime = (mime) => mime === "image/webp" ? "webp" : (mime === "image/png" ? "png" : "jpg");
  const stripExt = (s) => (s || "").trim().replace(/\.(jpg|jpeg|png|webp)$/i, "");
  const downloadName = () => {
    const base = stripExt(outName.value) || "resized";
    return `${base}.${extForMime(format.value)}`;
  };

  const fmtBytes = (b) => {
    const units = ["B","KB","MB","GB"];
    let i = 0, n = b;
    while (n >= 1024 && i < units.length - 1) { n /= 1024; i++; }
    return `${n.toFixed(i===0?0:2)} ${units[i]}`;
  };

  const addPill = (text, isError=false) => {
    const s = document.createElement("span");
    s.className = "pill" + (isError ? " error" : "");
    s.textContent = text;
    stats.appendChild(s);
  };
  const clearPills = () => stats.innerHTML = "";

  const setReady = (ready) => {
    runBtn.disabled = !ready;
    if (!ready) {
      shareBtn.disabled = true;
      openImgBtn.disabled = true;
    }
  };

  function safeInt(v, fallback=1600){
    const n = Math.round(Number(v));
    return Number.isFinite(n) && n > 0 ? n : fallback;
  }

  function cleanupOutUrl(){
    if (outUrl) {
      URL.revokeObjectURL(outUrl);
      outUrl = null;
    }
  }

  // UI init
  qVal.textContent = Number(quality.value).toFixed(2);
  quality.addEventListener("input", () => qVal.textContent = Number(quality.value).toFixed(2));
  format.addEventListener("change", () => {
    outName.value = stripExt(outName.value);
  });

  // Show Kakao banner
  window.addEventListener("load", () => {
    if (isKakaoInApp()) {
      banner.style.display = "block";
    }
  });

  copyLinkBtn.addEventListener("click", async () => {
    const url = location.href;
    try {
      if (navigator.clipboard && navigator.clipboard.writeText) {
        await navigator.clipboard.writeText(url);
      } else {
        // fallback
        const ta = document.createElement("textarea");
        ta.value = url;
        document.body.appendChild(ta);
        ta.select();
        document.execCommand("copy");
        ta.remove();
      }
      alert("ë§í¬ë¥¼ ë³µì‚¬í–ˆì–´ìš”! Safari ì£¼ì†Œì°½ì— ë¶™ì—¬ë„£ìœ¼ë©´ ë” ì•ˆì •ì ìœ¼ë¡œ ì—´ë ¤ìš”.");
    } catch (e) {
      alert("ë³µì‚¬ì— ì‹¤íŒ¨í–ˆì–´ìš”. ì£¼ì†Œì°½ì˜ ë§í¬ë¥¼ ì§ì ‘ ë³µì‚¬í•´ ì£¼ì„¸ìš”.");
    }
  });

  hintBtn.addEventListener("click", () => {
    alert("ì €ì¥ ë°©ë²•\n1) 'ì¤„ì´ê¸°' ëˆ„ë¥´ê¸°\n2) ì•„ë˜ ê²°ê³¼ ì´ë¯¸ì§€ê°€ ë‚˜íƒ€ë‚˜ë©´ ì´ë¯¸ì§€ë¥¼ ê¸¸ê²Œ ëˆ„ë¥´ê¸°\n3) 'ì‚¬ì§„ì— ì €ì¥/ì‚¬ì§„ì— ì¶”ê°€'\n\në˜ëŠ” 'ê³µìœ /ì €ì¥' ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ì‚¬ì§„ ì•±/íŒŒì¼ ì•±ìœ¼ë¡œ ì €ì¥í•  ìˆ˜ ìˆì–´ìš”.");
  });

  // iOS/ì¹´í†¡ ì•ˆì • ë¡œë”©: FileReader -> dataURL -> img.onload
  async function loadFile(file){
    clearPills();
    cleanupOutUrl();

    outBlob = null;
    resultImg.style.display = "none";
    saveGuide.style.display = "none";
    shareBtn.disabled = true;
    openImgBtn.disabled = true;

    originalFile = file;
    setReady(false);

    addPill(`íŒŒì¼: ${file.name || "(ì´ë¦„ì—†ìŒ)"}`);
    addPill(`ìš©ëŸ‰: ${fmtBytes(file.size)}`);

    const base = stripExt((file.name || "photo"));
    outName.value = `${base}_resized`;

    const dataUrl = await new Promise((resolve, reject) => {
      const reader = new FileReader();
      reader.onload = () => resolve(reader.result);
      reader.onerror = () => reject(new Error("FileReader ì‹¤íŒ¨"));
      reader.readAsDataURL(file);
    });

    const img = new Image();
    loadedImage = img;

    await new Promise((resolve, reject) => {
      img.onload = resolve;
      img.onerror = () => reject(new Error("ì´ë¯¸ì§€ ë””ì½”ë”© ì‹¤íŒ¨"));
      img.src = dataUrl;
    });

    origImg.src = img.src;
    addPill(`í•´ìƒë„: ${img.naturalWidth}Ã—${img.naturalHeight}`);

    setReady(true);
  }

  fileInput.addEventListener("change", async (e) => {
    const f = e.target.files && e.target.files[0];
    if (!f) return;
    try{
      await loadFile(f);
    }catch(err){
      clearPills();
      addPill(`ì—ëŸ¬: ${err.message}`, true);
      setReady(false);
      console.error(err);
      alert("ì‚¬ì§„ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆì–´ìš”. (HEICì´ë©´ ìŠ¤í¬ë¦°ìƒ·/ë‹¤ë¥¸ ì‚¬ì§„ìœ¼ë¡œ ì‹œë„í•´ ì£¼ì„¸ìš”)");
    }
  });

  // canvas.toBlob í´ë°±
  function canvasToBlob(canvas, mime, quality){
    return new Promise((resolve) => {
      if (canvas.toBlob) {
        if (mime === "image/png") canvas.toBlob(resolve, mime);
        else canvas.toBlob(resolve, mime, quality);
      } else {
        const dataURL = (mime === "image/png")
          ? canvas.toDataURL(mime)
          : canvas.toDataURL(mime, quality);

        const parts = dataURL.split(",");
        const b64 = parts[1] || "";
        const bytes = atob(b64);
        const arr = new Uint8Array(bytes.length);
        for (let i=0; i<bytes.length; i++) arr[i] = bytes.charCodeAt(i);
        resolve(new Blob([arr], { type: mime }));
      }
    });
  }

  runBtn.addEventListener("click", async () => {
    clearPills();
    cleanupOutUrl();

    if (!loadedImage || !originalFile){
      addPill("ì—ëŸ¬: ì‚¬ì§„ì´ ë¡œë“œë˜ì§€ ì•Šì•˜ì–´ìš”", true);
      setReady(false);
      return;
    }

    const ow = loadedImage.naturalWidth;
    const oh = loadedImage.naturalHeight;

    const mw = safeInt(maxW.value, 1600);
    const mh = safeInt(maxH.value, 1600);

    const scale = Math.min(mw / ow, mh / oh, 1);
    const nw = Math.max(1, Math.round(ow * scale));
    const nh = Math.max(1, Math.round(oh * scale));

    canvas.width = nw;
    canvas.height = nh;

    ctx.clearRect(0,0,nw,nh);
    ctx.imageSmoothingEnabled = true;
    ctx.imageSmoothingQuality = "high";
    ctx.drawImage(loadedImage, 0, 0, nw, nh);

    const mime = format.value;
    const q = Number(quality.value);

    outBlob = await canvasToBlob(canvas, mime, q);
    if (!outBlob){
      addPill("ì—ëŸ¬: ë³€í™˜ ì‹¤íŒ¨", true);
      shareBtn.disabled = true;
      openImgBtn.disabled = true;
      return;
    }

    outUrl = URL.createObjectURL(outBlob);

    // âœ… ì¹´í†¡/ì•„ì´í° ì €ì¥ ìµœê°• ë£¨íŠ¸: ê²°ê³¼ ì´ë¯¸ì§€ë¥¼ imgë¡œ ë³´ì—¬ì£¼ê¸°
    resultImg.src = outUrl;
    resultImg.style.display = "block";
    saveGuide.style.display = "block";

    const ratio = ((outBlob.size / originalFile.size) * 100).toFixed(1);
    addPill(`ì›ë³¸: ${fmtBytes(originalFile.size)} / ${ow}Ã—${oh}`);
    addPill(`ê²°ê³¼: ${fmtBytes(outBlob.size)} (${ratio}%) / ${nw}Ã—${nh}`);
    addPill(`íŒŒì¼ëª…: ${downloadName()}`);

    shareBtn.disabled = false;
    openImgBtn.disabled = false;

    // ê²°ê³¼ë¡œ ìŠ¤í¬ë¡¤
    setTimeout(() => {
      resultImg.scrollIntoView({ behavior: "smooth", block: "start" });
    }, 80);
  });

  // âœ… ê³µìœ /ì €ì¥: ì§€ì›ë˜ë©´ Web Shareë¡œ "íŒŒì¼" ê³µìœ  (ì‚¬ì§„ì•±/íŒŒì¼ì•±ì— ì €ì¥ ê°€ëŠ¥)
  shareBtn.addEventListener("click", async () => {
    if (!outBlob) {
      alert("ë¨¼ì € 'ì¤„ì´ê¸°'ë¥¼ ëˆŒëŸ¬ ê²°ê³¼ ì´ë¯¸ì§€ë¥¼ ë§Œë“¤ì–´ ì£¼ì„¸ìš”.");
      return;
    }

    const filename = downloadName();

    // Web Share Level 2 (files)
    try {
      if (navigator.share) {
        const file = new File([outBlob], filename, { type: outBlob.type || format.value });
        // canShareê°€ ìˆìœ¼ë©´ ë” ì•ˆì „
        if (!navigator.canShare || navigator.canShare({ files: [file] })) {
          await navigator.share({ files: [file], title: filename, text: "ì¤„ì¸ ì´ë¯¸ì§€" });
          return;
        }
      }
    } catch (e) {
      // ì•„ë˜ í´ë°±ìœ¼ë¡œ ì§„í–‰
      console.warn(e);
    }

    // í´ë°±: ê²°ê³¼ ì´ë¯¸ì§€ë¡œ ì´ë™í•´ì„œ ê¸¸ê²Œ ëˆŒëŸ¬ ì €ì¥ ì•ˆë‚´
    alert("ì´ í™˜ê²½ì—ì„œëŠ” 'ê³µìœ ë¡œ íŒŒì¼ ì €ì¥'ì´ ì œí•œë  ìˆ˜ ìˆì–´ìš”.\nì•„ë˜ ê²°ê³¼ ì´ë¯¸ì§€ë¥¼ ê¸¸ê²Œ ëˆŒëŸ¬ 'ì‚¬ì§„ì— ì €ì¥/ì¶”ê°€' í•´ì£¼ì„¸ìš”.");
    if (resultImg && resultImg.src) {
      resultImg.scrollIntoView({ behavior: "smooth", block: "start" });
    }
  });

  // âœ… ê²°ê³¼ ì´ë¯¸ì§€ í¬ê²Œ ì—´ê¸° (ì¸ì•±ì—ì„œ window.openì´ ë§‰í ìˆ˜ ìˆì–´ ê°™ì€ íƒ­ ì´ë™ë„ ì œê³µ)
  openImgBtn.addEventListener("click", () => {
    if (!outBlob || !outUrl) {
      alert("ë¨¼ì € 'ì¤„ì´ê¸°'ë¥¼ ëˆŒëŸ¬ ê²°ê³¼ ì´ë¯¸ì§€ë¥¼ ë§Œë“¤ì–´ ì£¼ì„¸ìš”.");
      return;
    }

    // ì¸ì•±ì—ì„œ ìƒˆíƒ­ì´ ë§‰íˆë©´ ê°™ì€ íƒ­ìœ¼ë¡œ ì´ë™
    const win = window.open(outUrl, "_blank");
    if (!win) {
      window.location.href = outUrl;
    }
  });

  resetBtn.addEventListener("click", () => {
    fileInput.value = "";
    originalFile = null;
    loadedImage = null;
    outBlob = null;

    cleanupOutUrl();

    origImg.removeAttribute("src");
    resultImg.removeAttribute("src");
    resultImg.style.display = "none";
    saveGuide.style.display = "none";

    ctx.clearRect(0,0,canvas.width,canvas.height);
    canvas.width = 300; canvas.height = 150;

    maxW.value = 1600;
    maxH.value = 1600;
    quality.value = 0.82;
    qVal.textContent = "0.82";
    format.value = "image/jpeg";
    outName.value = "";

    clearPills();
    setReady(false);
  });

  // Init canvas
  canvas.width = 300;
  canvas.height = 150;
  setReady(false);
</script>
</body>
</html>
